# Бие даалт – Тайлан

## Machine 09 — <Broker, IP:10.10.11.243>

### 1.) Сканны үр дүнд TCP 61616 портоор Apache ActiveMQ 5.15.15 ажиллаж байгааг, мөн SSH ба NGINX өөрсдийн анхдагч портууд дээр ажиллаж байгааг илрүүлэв.

![nmap](image.png)

### ActiveMQ-ийн энэ хувилбарын эмзэг байдлыг хайж үзэхэд CVE-2023-46604 гэж тэмдэглэсэн эмзэг байдалд өртөмтгий нь харагдсан.

![exploit](image-1.png)

![github](image-2.png)

### 2.) CVE-2023-46606 exploit оо ашиглаж байгаа нь ClassPathXmlApplicationContext.

![alt text](image-3.png)

### 3.) Репозитори дахь README-д дурдсанаар, зорилтот дээр байршуулж ажиллуулах ELF гүйцэтгэх файлыг авахын тулд бид msfvenom payload үүсгэнэ.

![alt text](image-4.png)

### 4.) Дараа нь poc-linux.xml файлыг засварлаад IP хаягийг өөрийн вэб серверийнхээр солино.

![alt text](image-5.png)

### 5.) Бид Python3 HTTP серверийг арын горимд ажиллуулж

![alt text](image-7.png)

### 6.) Netcat сонсогчийг эхлүүлнэ.

![alt text](image-8.png)

### 7.) Эцэст нь шинэ терминал нээгээд дараах командыг ажиллуулна

![alt text](image-6.png)

### 8.) Сонсогчоо шалгахад холболт буцаж ирж, зорилтот дээр алсын код гүйцэтгэх боломжийг амжилттай олж авлаа.

![alt text](image-9.png)

### 9.) Sudo эрхээ шалгахад өөрийн nginx тохиргооны файлыг ачаалж болох нь илэрлээ.

![alt text](image-10.png)

### 10.) Тохиргоог нэг файлд хадгалаад, NGINX-ийг -c тугаар тэр файлыг ашиглахаар тохируулна. Хортой тохиргоо идэвхтэй байгаа эсэхийг баталгаажуулахын тулд ss ашиглан нээлттэй портуудыг шалгана:

![alt text](image-11.png)

### 11.) 1337 порт үнэхээр нээлттэй байгааг харлаа. Тиймээс эцсийн алхам болгож өөрийн public SSH түлхүүрийг /root/.ssh/authorized_keys файлд бичнэ. Эцэст нь файлыг бичих PUT хүсэлтийг илгээхэд cURL ашиглана. Document root-ийг / болгосон тул бүрэн замыг /root/.ssh/authorized_keys гэж заагаад, бичигдэх файлын агуулгыг өөрийн public түлхүүрээр тохируулахын тулд -d тугийг ашиглана.

![alt text](image-12.png)

### 12.) Root flag /root/root.txt файлд байна.

![alt text](image-13.png)

### 13.) User flag /home/activemq/user.txt файлд байна.

![alt text](image-14.png)

### Дүгнэлт — Broker

# Гол шалтгаан: ActiveMQ-ийн CVE-2023-46604 RCE + sudo буруу тохиргоо

# Гүйцэтгэл: RCE → activemq хэрэглэгчийн shell → sudo nginx-ээр WebDAV PUT идэвхжүүлж root-ын authorized_keys руу бичив → root

### Кибер халдлагад тэсвэртэй байдлын зөвлөмж — Broker

### ActiveMQ шинэчлэлт: Вендорын залруулга орсон хувилбар руу даруй шинэчил. Эмзэг десериалчлалыг идэвхгүй/хязгаарласан эсэхийг баталгаажуул.
